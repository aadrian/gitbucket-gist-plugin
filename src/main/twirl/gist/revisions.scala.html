@(active: String, gist: model.Gist, editable: Boolean,
  revisions: List[(util.JGitUtil.CommitInfo, List[util.JGitUtil.DiffInfo])])(implicit context: app.Context)
@import context._
@import view.helpers._
@import org.eclipse.jgit.diff.DiffEntry.ChangeType

@sidemenu(path: String, name: String, label: String, count: Int = 0) = {
  <li @if(active == name){class="active"}>
    <div class="@if(active == name){margin} else {gradient} pull-left"></div>
    <a href="@context.path/gist/@path">
      @if(active == name){
        <img src="@assets/common/images/menu-@{name}-active.png">
      } else {
        <img src="@assets/common/images/menu-@{name}-active.png" class="menu-icon-active" style="display:none;">
        <img src="@assets/common/images/menu-@{name}.png"        class="menu-icon">
      }
      @label
      @if(count > 0){
        <div class="pull-right"><span class="label">@count</span></div>
      }
    </a>
  </li>
}

@html.main("Snippet"){
  <div class="container">
    <div class="head">
      @avatar(gist.userName, 24)
      <a href="@path/gist/@gist.userName">@gist.userName</a> /
      <a href="@path/gist/@gist.userName/@gist.repositoryName" class="strong">@gist.title</a>
      @if(gist.isPrivate){
        <span class="label label-warning">Secret</span>
      }
      @if(editable){
        <div class="pull-right">
          <a href="@path/gist/@gist.userName/@gist.repositoryName/edit" class="btn">Edit</a>
          <a href="@path/gist/@gist.userName/@gist.repositoryName/delete" class="btn" id="delete">Delete</a>
        </div>
      }
    </div>
    <div class="muted" style="margin-top: -10px; margin-left: 30px;">
      Created at @gist.registeredDate
    </div>
  </div>
  <hr style="margin-bottom: 20px;"/>
  <div class="container body">
    <div style="width: 170px;" class="pull-right">
      <ul class="sidemenu">
        <li style="height: 12px"><div class="gradient pull-left" style="height: 12px"></div></li>
        @sidemenu(s"${gist.userName}/${gist.repositoryName}",           "code"    , "Code")
        @sidemenu(s"${gist.userName}/${gist.repositoryName}/revisions", "revision", "Revision")
      </ul>
    </div>
    <div style="margin-right: 180px;">
      @revisions.map { case (revision, diffs) =>
        <div>
          <div style="margin-bottom: 8px;">
            @avatar(revision, 20) <a href="@path/gist/@revision.authorName">@revision.authorName</a> revised this @helper.html.datetimeago(revision.authorTime)
            <div class="pull-right">
              <a href="#" class="btn btn-mini monospace">@revision.id.substring(0, 7)</a>
            </div>
          </div>
          <div>
            @diffs.zipWithIndex.map { case (diff, i) =>
              <table class="table table-bordered">
                <tr>
                  <th style="font-weight: normal; line-height: 27px;" class="box-header">
                    @diff.changeType match {
                      case ChangeType.ADD => {
                        <img src="@assets/common/images/diff_add.png"/> @diff.newPath
                      }
                      case ChangeType.MODIFY => {
                        <img src="@assets/common/images/diff_edit.png"/> @diff.newPath
                      }
                      case ChangeType.DELETE => {
                        <img src="@assets/common/images/diff_delete.png"/> @diff.oldPath
                      }
                      case _ => {
                      }
                    }
                  </th>
                </tr>
                <tr>
                  <td style="padding: 0;">
                    @if(diff.newContent != None || diff.oldContent != None){
                      <div id="diffText-@revision.id.substring(0, 7)-@i"></div>
                      <textarea id="newText-@revision.id.substring(0, 7)-@i" style="display: none;">@diff.newContent.getOrElse("")</textarea>
                      <textarea id="oldText-@revision.id.substring(0, 7)-@i" style="display: none;">@diff.oldContent.getOrElse("")</textarea>
                    } else {
                      Not supported
                    }
                  </td>
                </tr>
              </table>
            }
          </div>
        </div>
      }
    </div>
  </div>
  <script type="text/javascript" src="@assets/vendors/jsdifflib/difflib.js"></script>
  <script type="text/javascript" src="@assets/vendors/jsdifflib/diffview.js"></script>
  <link href="@assets/vendors/jsdifflib/diffview.css" type="text/css" rel="stylesheet" />
  <script>
  $(function(){
    renderDiffs(1);

    function renderDiffs(viewType){
      window.viewType = viewType;
      @revisions.map { case (revision, diffs) =>
        @diffs.zipWithIndex.map { case (diff, i) =>
          @if(diff.newContent != None || diff.oldContent != None){
            if($('#oldText-@revision.id.substring(0, 7)-@i').length > 0){
              diffUsingJS('oldText-@revision.id.substring(0, 7)-@i', 'newText-@revision.id.substring(0, 7)-@i', 'diffText-@revision.id.substring(0, 7)-@i', viewType);
            }
          }
        }
      }
    }
  });
  </script>
}